# File naming conventions

Filenames need many descriptors to be unambiguous and sortable. The
convention below outlines appropriate metadata to include in filenames
to group them logically and allow for easy filtering by subsequent
scripts. This convention is based on an [almost flat][flat] naming
scheme that assumes all data generated by all instruments will be dumped
or archived in a central location. This naming convention allows for
programmatic reorganization at a later time.

```
sample_location_identifier_meas-type_source_set-power_NDfilter_objective_date-time.WIP
```

Note that fields are separated by underscores and that any multi-word
settings or field contents are separated by dashes. The important rule
is that **spaces are not encouraged**. Fields may be abbreviated.

| Field        | Value                                                                                               |
|--------------|-----------------------------------------------------------------------------------------------------|
| `sample`     | An abbreviated sample name, maintained in a separate database                                       |
| `location`   | An approximate location of where you are on the sample                                              |
| `identifier` | A way to identify which flake or region you are collecting                                          |
| `meas-type`  | Measurement type (confocal, external spectrum, AFM, SNOM) and whether in reflection or transmission |
| `source`     | Illumination (lasers expressed in nm, LED expressed by band)                                        |
| `set`-power  | (Necessary for Verdi only) Reading on laser power supply                                            |
| `NDfilter`   | (Necessary for Verdi only) Filter in place before fiber                                             |
| `objective`  | Microscope objective, identified by magnification                                                   |
| `date-time`  | YYYYMMDD-HHMM / YYYYMMDD-HHMMSS / YYYY-MM-DD-HH-MM where HH is in 24hr format                       |

The explicit presence of the `date` and `time` in the filename is to
differentiate between multiple acquisitions taken under the same
parameters. Both _ScanCtrlSpectroscopyPlus_ and _WinSpec_ provide an
option to auto-increment numbers at the end of a file when performing
sequential measurements, which is their attempt at maintaining globally
unique filenames. This method fails when you repeat an identical
measurement after opening a new program session or revisit a previous
sample to reacquire data, but is an appropriate stand-in for cases when
you can't programmatically assign a filename based on the current date
and time.

Given that the metadata in the files already contain the date and time,
users may opt to discard these fields at their discretion or when the
file has been appropriately bundled, archived, or otherwise uniquely
identified. If present, the date should be expressed in ISO 8601
standard, with optional dashes allowed between `YYYY-MM-DD` and
`HH-MM-SS`.

This project enforces no strict folder hierarchy for how data should be
organized after acquisition, as we expect users to maintain their own
data in whatever ways make sense to them. The guidelines herein ensure
that data generated from scripts in this can be deciphered by end-users
and manipulated by other scripts in this project.

## Examples

```
hBN-10_loc1A_flake01_conf-r_532nm_080mW_ND10A_obj50x_20230615-1324.WIP
Si-pillars_loc2B-2-7_nozzle_exts-r_405nm_obj50x_20230527-1712.WIP
```

| Field        | Example                   | Description                                         |
|--------------|---------------------------|-----------------------------------------------------|
| `sample`     | hBN-10                    | hBN made with Boron-10                              |
| `sample`     | Si-pillars                | hBN on nanopillars etched onto a Si substrate       |
| `location`   | loc1A                     | (Sample was partitioned into grids) view of grid 1A |
| `location`   | loc2B-2-7                 | Grid 2B, row 2, column 7                            |
| `identifier` | flake01                   | Arbitrarily defined flake w/in field of view        |
| `identifier` | nozzle                    | Description of shape of flake                       |
| `meas-type`  | conf-r                    | Confocal acquisition (w/ APD) in reflection mode    |
| `meas-type`  | conf                      | Confocal acquisition (w/ APD) (assumed: reflection) |
| `meas-type`  | exts-r                    | (EXT)ernal image (S)pectrum, reflection             |
| `meas-type`  | exts                      | (EXT)ernal image (S)pectrum, assumed: reflection    |
| `meas-type`  | conf-t                    | Confocal in transmission mode                       |
| `meas-type`  | snom-r                    | SNOM in reflection mode                             |
| `meas-type`  | afm-c                     | AFM in contact mode                                 |
| `meas-type`  | afm-n                     | AFM in non-contact mode                             |
| `meas-type`  | afm-t                     | AFM in tapping mode                                 |
| `source`     | 532nm                     | Verdi 532 nm (accompany w/ power settings)          |
| `source`     | 405nm                     | 405 nm (no additional power settings needed)        |
| `source`     | UVLED                     | LED lamp with peak emission in ultraviolet          |
| `set`-power  | 080mW                     | (pad w/ leading zeros)                              |
| `NDfilter`   | ND10A                     | Name of neutral density filter before fiber         |
| `NDfilter`   | ND0                       | Explicitly state that no ND filter is in place      |
| `objective`  | obj50x                    | 50x objective                                       |
| `date-time`  | 2023-06-15-16-28          | June 15, 2023 at 4:28 PM local time                 |
| `date-time`  | 20230615-1628             | June 15, 2023 at 4:28 PM local time                 |
| `date-time`  | 2023‐06‐15T14:28:39−07:00 | 2023-06-15 at 21:28 UTC-7:00 (time zone)            |
| `date-time`  | 20230615T212839Z          | 2023-06-15 at 21:28 UTC time (Zulu)                 |

In cases where the `location` and `identifier` are not known or easily
determined before acquisition, a description of the flake by shape or
acquisition sequence may suffice as descriptors.

## Motivation

The formula to describe your file should look something like this:

```
short-description_acquisition-type_settings_timestamp.WIP`
```

When collecting data directly from the WITec AlphaSNOM, aim to describe
the above fields in as succinct a manner as possible.

The `settings` field in the convention above is a placeholder for many
potential deviations that may depend on the specific acquisition. The
parameters that belong here are acquisition parameters that are not
already included in the file metadata.

See also:
- [File naming conventions](https://datamanagement.hms.harvard.edu/plan-design/file-naming-conventions)
- [Axiom Data Science](https://www.axiomdatascience.com/best-practices/DataManagementIntro.html)

[flat]: https://github.com/mitcommlab/Coding-Documentation/blob/master/File-Structure-Case-Studies.md#case-study-1-almost-flat

### Confocal image

A confocal image is fundamentally a series of measurements acquired at a
2D grid of coordinates. The shape and size of the grid is already stored
in the `.WIP` file, along with other parameters like the exposure
duration and date.

The experimental setup requires manual tweaks outside the scope of
_ScanCtrlSpectroscopy_, such as the laser power and choice of microscope
objective. This convention recommends describing these settings as a
sequence of how they are set, tracing from the source to the sample.

For instance, `settings` might be expanded in a confocal measurement to
include the following slug:

```
...wavelength_set-power_NDfilter_objective...
```

where it is assumed the setup is known and characterized based on these
parameters. In Stevenson 6517, the 532 nm Verdi laser is directed
through a neutral density (ND) filter and into a fiber, where it is
assumed to be focused onto the sample. These settings allow us to look
up the measured power at the sample and determine the actual power at
the sample. The additional presence of a date field allows us to look
back at any previously characterized setup if we make changes to the
optics assembly and log them appropriately by date..

Stevenson 6517 also contains an additional 405 nm diode laser, but this
is coupled directly into a fiber and does not have any adjustments that
can be made. Such a `settings` slug might look like this:

```
...wavelength_objective...
```

### External image spectrum

The following rule adopts convention 2 outlined near the end of [WITec
data formats](witec_formats.md) in that `.SPE` and `.WIP` files are
maintained as separate files complete with their own metadata.

If collecting an external image spectrum, the external WinSpec process
will create an additional file that stores the spectra outside of the
`.WIP` file. This file is strongly coupled to the parent
_ScanCtrlSpectroscopy_ process that called it, so the convention aims to
keep these files sorted together by using the same filename.

```
sample_location_acquisition-type_settings_date.SPE`
```

The metadata in the `.SPE` file contains many fields, such as
information about the grating and its position, the exposure time,
whether each spectrum was subtracted from a known background file, and
if any averaging was performed on the spectra. These would be redundant
fields to include in the filename, but sometimes it is helpful to
include these in the `settings` field if only because it helps
differentiate multiple acquisitions collected within the scope of a
specific investigation.

The relevant consideration is that the `settings` field be identical
between files. If there are additional tweaks to the setup that are made
present in an external image spectrum that are not contained in the
metadata of the `.SPE` or `.WIP` file, or additional and redundant descriptors are
deliberately included the settings to aid in mental differentiation,
they belong at the end of the `settings` field. Aim to include
abbreviated `keyword-value` fields separated by additional underscores
on either side.

## Additional processing

After data is collected from various instruments, you might make use of
scripts in this project to combine `.SPE` and `.WIP` files into one
`.hdf5` file for better packaging. The metadata in the `.WIP` and `.SPE`
filenames can and should be added to an appropriate (newly created)
metadata field in the `.hdf5` file. After this is done, some of the
descriptors in the filename may be safely removed if desired, but the
**original source data should remain intact**.

You may choose to keep these combined `.hdf5` files in separate folders
based on logical groupings. In cases where the folder structure contains
information present in the filename, you may also discard the filename
descriptor that duplicates this information.

```bash
mv sample_conf-r_settings_date.hdf5 user/sample/confocal/settings.hdf5
```

Some suggestions below outline potential avenues for data maintenance.

### Additional sorting

Be aware that projects exist that can help manage, search, and access
data by its parameters space such that strict folder management is not
necessary. Using a tag-based indexing instead of a folder-based indexing
may appear messier for human inspection, but it provides quicker search
results for large file sets and allows for groupings that don't fit
cleanly into folders.

For example, in a folder-based structure all of Justin's measurements
might be under a `Justin` user folder, and all of Britney's measurements
might be under a `Britney` user folder. If Justin and Britney
collaborate on the same project, however, they need to decide whose
folder the data belongs under. Maybe they make a new folder
`Britney+Justin`. Two years later, Justin wants to grab all the data he
is responsible for and make a permanent backup of it. Hopefully he
remembers to also grab the `Britney+Justin` folder and any other
collaboration folders.

In a tag-based structure, Justin tags any files that belong to him with
a metadata tag, say, `owner: Justin`. Files can have multiple owners.
They can also have tags pertaining to who performed the measurement.
When Justin wants to make his archive, he can simply ask a program to
find all files with `owner: Justin` somewhere in their metadata and dump
those into `Justin-archive.zip`

Projects like [signac](https://github.com/glotzerlab/signac) attempt to
make this latter organization principle easier to implement in Python.
Users are expected to lump all data and their associated metadata into a
single project folder. Files are given a hashable index as a filename
for quicker machine recall, but this then obscures human browsing of the
file structure. Instead, individual files are expected to be retrieved
through scripts to downselect members of a project folder based on
user-defined filters. At any time, users can use a script to auto-sort
data into meaningful folder structures based on an appropriate filter
criteria. Each sorting is called a _view_. These views can be undone and
refined at any time as the project becomes more nuanced in scope.
